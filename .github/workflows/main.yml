# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
name: Snyk Security
on: [push, pull_request]

permissions:
  contents: read

jobs:
  snyk:
    permissions:
      contents: read # for actions/checkout to fetch code
      security-events: write # for github/codeql-action/upload-sarif to upload SARIF results
      actions: read # only required for a private repository by github/codeql-action/upload-sarif to get the Action run status
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Snyk CLI to check for security issues
        uses: snyk/actions/setup@master
        env:
          # This is where you will need to introduce the Snyk API token created with your Snyk account
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
      - name: Authenticate Snyk
        run: |
          export SNYK_TOKEN=${{ secrets.SNYK_TOKEN }}
          snyk auth $SNYK_TOKEN --auth-type=token
        # Runs Snyk Code (SAST) analysis and uploads result into GitHub.
        # Use || true to not fail the pipeline
      - name: Snyk Code test
        run: snyk code test --org=${{ secrets.SNYK_ORG }} #--sarif > snyk-sarif2.1.0.json || true

        # Runs Snyk Open Source (SCA) analysis and uploads result to Snyk.
      #- name: Snyk Open Source monitor
        #run: snyk monitor --all-projects
